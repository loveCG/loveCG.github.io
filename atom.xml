<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>工作笔记</title>
  
  <subtitle>只修电脑，不过夜，谢谢！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lovecg.tech/"/>
  <updated>2018-07-11T07:19:11.304Z</updated>
  <id>http://lovecg.tech/</id>
  
  <author>
    <name>Kevin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>XMPP连接遇到的问题及解决</title>
    <link href="http://lovecg.tech/2017/12/22/XMPP%E8%BF%9E%E6%8E%A5%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3/"/>
    <id>http://lovecg.tech/2017/12/22/XMPP连接遇到的问题及解决/</id>
    <published>2017-12-22T10:00:00.000Z</published>
    <updated>2018-07-11T07:19:11.304Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、11"><a href="#一、11" class="headerlink" title="一、11"></a>一、11</h1><p>最近使用ejabberd搭建IM服务器，使用smack内库连接XMPP。会一直报一个流错误的异常：</p><h1 id="二、22"><a href="#二、22" class="headerlink" title="二、22"></a>二、22</h1><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stream:error (text)</span><br><span class="line">at org<span class="selector-class">.jivesoftware</span><span class="selector-class">.smack</span><span class="selector-class">.PacketReader</span><span class="selector-class">.parsePackets</span>(PacketReader<span class="selector-class">.java</span>:<span class="number">251</span>)</span><br><span class="line">at org<span class="selector-class">.jivesoftware</span><span class="selector-class">.smack</span><span class="selector-class">.PacketReader</span><span class="selector-class">.access</span>$<span class="number">000</span>(PacketReader<span class="selector-class">.java</span>:<span class="number">46</span>)</span><br><span class="line">at org<span class="selector-class">.jivesoftware</span><span class="selector-class">.smack</span><span class="selector-class">.PacketReader</span>$<span class="number">1</span>.run(PacketReader<span class="selector-class">.java</span>:<span class="number">72</span>)</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="三、33"><a href="#三、33" class="headerlink" title="三、33"></a>三、33</h1><p>查阅了很多资料，发现问题所在:<br>当ejabberd设置max_user_sessions 为n的时候，同一用户使用相同的资源尝试 n+1 连接到服务器，导致正在使用的帐号被别人登录时挤下，然后报出stream:error (text)。<br>正常情况下普通用户会配置互踢，就是max_user_sessions= 1，客户端处理上面流错误实现客户端互踢功能。当管理员想要多个session同时登录，可以在ejabberd上配置：</p><h1 id="四、44"><a href="#四、44" class="headerlink" title="四、44"></a>四、44</h1><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">max_user_sessions:</span></span><br><span class="line"><span class="symbol">  admin:</span> <span class="number">10</span> </span><br><span class="line"><span class="symbol">  all:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>此配置的意思是，普通用户只允许一个session，管理员角色可最多允许10个session同时在线。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一、11&quot;&gt;&lt;a href=&quot;#一、11&quot; class=&quot;headerlink&quot; title=&quot;一、11&quot;&gt;&lt;/a&gt;一、11&lt;/h1&gt;&lt;p&gt;最近使用ejabberd搭建IM服务器，使用smack内库连接XMPP。会一直报一个流错误的异常：&lt;/p&gt;
&lt;h1 id=&quot;二、22&quot;&gt;&lt;a href=&quot;#二、22&quot; class=&quot;headerlink&quot; title=&quot;二、22&quot;&gt;&lt;/a&gt;二、22&lt;/h1&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;stream:error (text)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at org&lt;span class=&quot;selector-class&quot;&gt;.jivesoftware&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.smack&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.PacketReader&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.parsePackets&lt;/span&gt;(PacketReader&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;251&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at org&lt;span class=&quot;selector-class&quot;&gt;.jivesoftware&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.smack&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.PacketReader&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.access&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;000&lt;/span&gt;(PacketReader&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	at org&lt;span class=&quot;selector-class&quot;&gt;.jivesoftware&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.smack&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.PacketReader&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.run(PacketReader&lt;span class=&quot;selector-class&quot;&gt;.java&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;72&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Ejabberd" scheme="http://lovecg.tech/tags/Ejabberd/"/>
    
  </entry>
  
</feed>
